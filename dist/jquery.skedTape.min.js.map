{"version":3,"sources":["jquery.skedTape.js"],"names":["factory","define","amd","module","exports","root","jQuery","undefined","window","require","$","CURRENT_TZ_OFFSET","Date","getTimezoneOffset","SkedTape","opts","extend","this","$el","el","locations","events","lastEventId","format","defaultFormatters","formatters","on","proxy","handleEventClick","handleEventContextMenu","handleTimelineClick","handleTimelineContextMenu","handleMouseMove","handleKeyDown","handleWheel","handleIntersectionClick","handleIntersectionContextMenu","date","endian","delim","nums","getDate","getMonth","getFullYear","join","roundDuration","ms","duration","h","Math","floor","MS_PER_HOUR","m","MS_PER_MINUTE","hrs","min","hours","time","getHours","getMinutes","prototype","constructor","setTimespan","start","end","isValidTimeRange","Error","JSON","stringify","floorHours","setTime","getTime","ceilHours","updateUnlessOption","setDate","minHours","maxHours","midnight","setHours","MS_PER_DAY","getZoom","zoom","setZoom","maxZoom","$canvas","minWidth","data","css","round","resetZoom","zoomIn","inc","zoomStep","zoomOut","dec","locationExists","id","exists","each","i","location","setLocations","map","name","order","tzOffset","userData","addLocations","concat","addLocation","push","removeLocation","length","splice","getLocation","getLocations","sorting","orderBy","sort","a","b","toLocaleLowerCase","localeCompare","collide","event","max","minGapTimeBetween","addEvent","entry","newEvent","url","className","disabled","active","preserveId","getEvent","allowCollisions","collided","CollisionError","addEvents","forEach","update","setEvents","entries","removeAllEvents","removeEvent","eventId","find","remove","getEvents","found","isEditMode","editMode","enterEditMode","leaveEditMode","isAdding","cancelAdding","startAdding","dummyEvent","lastPicked","moveDummyEvent","updateDummyEvent","rerenderLocations","draggedEvent","jqEvent","Event","detail","trigger","$dummyEvent","rerenderLocation","$location","$locations","filter","replaceWith","renderLocation","empty","append","renderLocations","$text","text","attr","title","data-id","canAdd","canAddIntoLocation","postRenderLocation","$frag","document","createDocumentFragment","appendTo","parent","toggleClass","renderAside","$aside","caption","renderTimeWrap","oldScroll","$hours","renderHours","$wrap","$frame","scrollLeft","$timelineWrap","renderTimeRows","renderGrid","scrollWidth","clone","showDates","prepend","renderDates","d","$ul","firstMidnight","getMsToMidnight","lastMidnight","getMsFromMidnight","getMidnightBefore","queue","weight","day","totalWeight","reduce","total","item","proportion","toFixed","addClass","SHORT_DURATION","tick","hour","$time","toISOString","$li","children","not","width","$timeline","timeIndicators","$timeIndicator","hide","timeIndicatorSerifs","lastEnd","intersections","getIntersections","lastEndTime","belongs","visible","intersects","intersection","j","jEvent","gap","minTimeGapShown","maxTimeGapShown","renderGap","$event","renderEvent","maxTimeGapHi","renderIntersections","row","$row","locationId","computeEventWidth","left","computeEventOffset","block","findEventJustBefore","index","iEvent","findEventJustAfter","$dummyChildren","$dummyLeft","$dummyRight","leftText","rightText","showIntermission","prevEvent","interval","intermissionRange","nextEvent","html","$eventRow","closest","updateEvent","$oldEvent","$newEvent","$center","showEventTime","showEventDuration","$loose","top","body","outerWidth","postRenderEvent","eventEnd","getDurationHours","updateTimeIndicatorsPos","utcNow","Object","keys","now","offset","show","hasIntersections","eventA","eventB","findIntersection","occupied","destroy","cleanup","off","removeClass","fn","popover","TWBS_MAJOR","indicatorTimeout","clearInterval","render","oldScrollLeft","preserveScroll","setInterval","setTimeout","template","$entry","tooSmall","parseFloat","style","right","overflows","content","placement","requested","setSnapToMins","mins","snapToMins","findEventsAtTime","pick","e","scalar","pageX","bottom","height","pageY","makeMouseEvent","type","props","relatedTarget","currentTarget","clientX","clientY","offsetX","offsetY","screenX","screenY","dragEvent","component","isDefaultPrevented","preventDefault","rmbCancelsAdding","completeAdding","eventFromEvent","picked","hr","lower","beforeAddIntoLocation","key","ctrlKey","originalEvent","deltaY","shiftKey","scrollWithYWheel","delta","finish","animate","message","captureStackTrace","stack","create","parseInt","Constructor","VERSION","charAt","SECS_PER_DAY","target","getSeconds","getMilliseconds","skedTape","cmd","String","args","Array","slice","call","arguments","obj","dataKey","removeData","indexOf","apply","objOpts","defaults","deferRender"],"mappings":"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","file":"jquery.skedTape.min.js","sourcesContent":["var CURRENT_TZ_OFFSET = new Date().getTimezoneOffset();\n\nvar SkedTape = function(opts) {\n\t$.extend(this, opts);\n\n\tthis.$el = opts && opts.el ? $(opts.el) : $('<div/>');\n\tthis.el = opts.el instanceof $ ? opts.el[0] : opts.el;\n\n\tthis.locations = [];\n\tthis.events = [];\n\tthis.lastEventId = 0;\n\tthis.format = $.extend({}, SkedTape.defaultFormatters, (opts && opts.formatters) || {});\n\n\tthis.$el.on('click', '.sked-tape__event', $.proxy(this.handleEventClick, this));\n\tthis.$el.on('contextmenu', '.sked-tape__event', $.proxy(this.handleEventContextMenu, this));\n\tthis.$el.on('click', '.sked-tape__timeline-wrap', $.proxy(this.handleTimelineClick, this));\n\tthis.$el.on('contextmenu', '.sked-tape__timeline-wrap', $.proxy(this.handleTimelineContextMenu, this));\n\tthis.$el.on('mousemove', '.sked-tape__timeline-wrap', $.proxy(this.handleMouseMove, this));\n\tthis.$el.on('keydown', '.sked-tape__time-frame', $.proxy(this.handleKeyDown, this));\n\tthis.$el.on('wheel', '.sked-tape__time-frame', $.proxy(this.handleWheel, this));\n\tthis.$el.on('click', '.sked-tape__intersection', $.proxy(this.handleIntersectionClick, this));\n\tthis.$el.on('contextmenu', '.sked-tape__intersection', $.proxy(this.handleIntersectionContextMenu, this));\n};\n\nSkedTape.defaultFormatters = {\n\t/**\n\t * Formats the date.\n\t * \n\t * Note, since the component itself invokes the function with a single\n\t * argument, when overriding the function you should provide only the first\n\t * one. The sole purpose of the rest of them is to be used from the derived\n\t * function for convenience. \n\t * \n\t * @param {Date} date The date to format.\n\t * @param {'m'|'l'} endian Date format endianess ('m' - US, 'l' - EU).\n\t *                         Default value is 'm'.\n\t * @param {String} delim Date component delimiter.\n\t *                       Default - '/' or '.' depending on `endian`'s value.\n\t */\n\tdate: function(date, endian, delim) {\n\t\tendian = endian || 'm';\n\t\tdelim = delim || (endian === 'm' ? '/' : '.');\n\t\tvar nums = [date.getDate(), date.getMonth() + 1, date.getFullYear()];\n\t\tif (endian === 'm') {\n\t\t\tnums = [nums[1], nums[0], nums[2]];\n\t\t}\n\t\treturn nums.join(delim);\n\t},\n\troundDuration: function(ms) {\n\t\treturn ms;\n\t},\n\tduration: function (ms, opts) {\n\t\tvar h = Math.floor(ms / MS_PER_HOUR);\n\t\tvar m = Math.floor((ms % MS_PER_HOUR) / MS_PER_MINUTE);\n\t\tvar hrs = (opts && opts.hrs) || 'hrs';\n\t\tvar min = (opts && opts.min) || 'min';\n\t\tvar format = h ? h + hrs : '';\n\t\tformat += h && m ? ' ' : '';\n\t\tformat += m ? m + min : '';\n\t\treturn format;\n\t},\n\thours: function (hours) {\n\t\treturn (hours < 10 ? '0' : '') + hours + ':00';\n\t},\n\ttime: function (date) {\n\t\tvar h = date.getHours();\n\t\tvar m = date.getMinutes();\n\t\treturn (h < 10 ? '0' + h : h) + ':' + (m < 10 ? '0' + m : m);\n\t}\n};\n\nSkedTape.prototype = {\n\tconstructor: SkedTape,\n\tsetTimespan: function(start, end, opts) {\n\t\tif (!isValidTimeRange(start, end)) {\n\t\t\tthrow new Error('Invalid time range: ' + JSON.stringify([start, end]));\n\t\t}\n\t\tthis.start = floorHours(start);\n\t\tthis.end = ceilHours(end);\n\t\treturn this.updateUnlessOption(opts);\n\t},\n\t/**\n\t * A shorthand for `setTimespan()` that sets timespan between some\n\t * specified hours (optional) of a particular date.\n\t */\n\tsetDate: function(date, minHours, maxHours) {\n\t\tvar midnight = new Date(date);\n\t\tmidnight.setHours(0, 0, 0, 0);\n\t\tvar start = new Date(midnight);\n\t\tstart.setHours(minHours || 0);\n\t\tif (maxHours && maxHours != 24) {\n\t\t\tvar end = new Date(midnight.getTime());\n\t\t\tend.setHours(maxHours);\n\t\t} else {\n\t\t\tvar end = new Date(midnight.getTime() + MS_PER_DAY);\n\t\t}\n\t\treturn this.setTimespan(start, end);\n\t},\n\tgetZoom: function() {\n\t\treturn this.zoom;\n\t},\n\tsetZoom: function(zoom) {\n\t\tzoom = zoom || 1;\n\t\tif (zoom < 1) {\n\t\t\tthis.zoom = 1;\n\t\t\treturn this;\n\t\t}\n\t\tif (zoom > this.maxZoom) {\n\t\t\tthis.zoom = this.maxZoom;\n\t\t\treturn this;\n\t\t}\n\t\tthis.zoom = zoom;\n\t\tif (this.$canvas) {\n\t\t\tvar minWidth = this.$canvas.data('orig-min-width') * zoom;\n\t\t\tthis.$canvas.css('min-width', Math.round(minWidth) + 'px');\n\t\t}\n\t\treturn this;\n\t},\n\tresetZoom: function() {\n\t\treturn this.setZoom();\n\t},\n\tzoomIn: function(inc) {\n\t\treturn this.setZoom(this.zoom + (inc || this.zoomStep));\n\t},\n\tzoomOut: function(dec) {\n\t\treturn this.setZoom(this.zoom - (dec || this.zoomStep));\n\t},\n\tlocationExists: function(id) {\n\t\tvar exists = false;\n\t\t$.each(this.locations, function(i, location) {\n\t\t\tif (location.id == id) {\n\t\t\t\texists = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn exists;\n\t},\n\tsetLocations: function(locations, opts) {\n\t\tthis.events = [];\n\t\tthis.locations = locations && locations.map(function(location) {\n\t\t\treturn {\n\t\t\t\tid: location.id,\n\t\t\t\tname: location.name,\n\t\t\t\torder: location.order || 0,\n\t\t\t\ttzOffset: location.tzOffset,\n\t\t\t\tuserData: location.userData ? $.extend({}, location.userData) : {}\n\t\t\t};\n\t\t});\n\t\treturn this.updateUnlessOption(opts);\n\t},\n\taddLocations: function(locations, opts) {\n\t\tthis.locations = this.locations.concat(locations);\n\t\treturn this.updateUnlessOption(opts);\n\t},\n\taddLocation: function(location, opts) {\n\t\tthis.locations.push(location);\n\t\treturn this.updateUnlessOption(opts);\n\t},\n\tremoveLocation: function(id, opts) {\n\t\t// Remove corresponding events\n\t\tfor (var i = this.events.length - 1; i >= 0; --i) {\n\t\t\tif (this.events[i].location == id) {\n\t\t\t\tthis.events.splice(i, 1);\n\t\t\t}\n\t\t}\n\t\t// Remove the location\n\t\tfor (var i = 0; i < this.locations.length; ++i) {\n\t\t\tif (this.locations[i].id == id) {\n\t\t\t\tthis.locations.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this.updateUnlessOption(opts);\n\t},\n\tgetLocation: function(id) {\n\t\tfor (var i = 0; i < this.locations.length; ++i) {\n\t\t\tif (this.locations[i].id == id) {\n\t\t\t\treturn this.locations[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\tgetLocations: function() {\n\t\tvar locations = this.locations;\n\t\tif (this.sorting && this.orderBy === 'name') {\n\t\t\tlocations = locations.sort(function(a, b) {\n\t\t\t\ta = a.name.toLocaleLowerCase();\n\t\t\t\tb = b.name.toLocaleLowerCase();\n\t\t\t\treturn a.localeCompare(b);\n\t\t\t});\n\t\t}\n\t\telse if (this.sorting && this.orderBy === 'order') {\n\t\t\tlocations = locations.sort(function(a, b) {\n\t\t\t\treturn (a.order || 0) - (b.order || 0);\n\t\t\t});\n\t\t}\n\t\treturn locations;\n\t},\n\tcollide: function(event) {\n\t\tfor (var i = 0; i < this.events.length; ++i) {\n\t\t\tif (event.location == this.events[i].location &&\n\t\t\t\tgapBetween(event, this.events[i]) < this.minGapTimeBetween) {\n\t\t\t\treturn this.events[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\taddEvent: function(entry, opts) {\n\t\tif (!this.locationExists(entry.location)) {\n\t\t\tthrow new Error('Unknown location #' + entry.location);\n\t\t}\n\n\t\tvar start = entry.start instanceof Date ? entry.start : new Date(entry.start);\n\t\tvar end = entry.end instanceof Date ? entry.end : new Date(entry.end);\n\n\t\tif (!isValidTimeRange(start, end)) {\n\t\t\tthrow new Error('Invalid time range: ' +\n\t\t\t\tJSON.stringify([entry.start, entry.end]));\n\t\t}\n\n\t\tvar newEvent = {\n\t\t\tid: ++this.lastEventId,\n\t\t\tname: entry.name,\n\t\t\tlocation: entry.location + '',\n\t\t\tstart: start,\n\t\t\tend: end,\n\t\t\tdata: entry.data ? $.extend({}, entry.data) : null,\n\t\t\turl: entry.url || false,\n\t\t\tclassName: entry.className || null,\n\t\t\tdisabled: entry.disabled || false,\n\t\t\tactive: entry.active || false,\n\t\t\tuserData: $.extend({}, entry.userData || {})\n\t\t};\n\t\t\n\t\tif (opts && opts.preserveId && entry.id) {\n\t\t\tif (this.getEvent(entry.id)) {\n\t\t\t\tthrow new Error('Cannot preserve id: already exists');\n\t\t\t}\n\t\t\tnewEvent.id = entry.id;\n\t\t} else {\n\t\t\tnewEvent.id = ++this.lastEventId;\n\t\t}\n\n\t\tif (!opts || !opts.allowCollisions) {\n\t\t\tvar collided = this.collide(newEvent);\n\t\t\tif (collided) {\n\t\t\t\tthrow new SkedTape.CollisionError(collided.id);\n\t\t\t}\n\t\t}\n\n\t\tthis.events.push(newEvent);\n\n\t\tthis.updateUnlessOption(opts);\n\n\t\treturn newEvent;\n\t},\n\taddEvents: function(events, opts) {\n\t\tevents.forEach(function(event) {\n\t\t\tthis.addEvent(event, $.extend({}, {update: false}, opts));\n\t\t}, this);\n\t\treturn this.updateUnlessOption(opts);\n\t},\n\tsetEvents: function(entries, opts) {\n\t\treturn this.removeAllEvents(opts).addEvents(entries, opts);\n\t},\n\tremoveEvent: function(eventId, opts) {\n\t\t$.each(this.events, $.proxy(function(i, event) {\n\t\t\tif (event.id == eventId) {\n\t\t\t\tthis.events.splice(i, 1);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}, this));\n\t\treturn this.updateUnlessOption(opts);\n\t},\n\tremoveAllEvents: function(opts) {\n\t\tthis.$el.find('.sked-tape__event, .sked-tape__gap').remove();\n\t\tthis.events = [];\n\t\treturn this.updateUnlessOption(opts);\n\t},\n\tgetEvents: function() {\n\t\treturn this.events;\n\t},\n\tgetEvent: function(id) {\n\t\tvar found = null;\n\t\t$.each(this.events, $.proxy(function(i, event) {\n\t\t\tif (event.id == id) {\n\t\t\t\tfound = event;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}, this));\n\t\treturn found;\n\t},\n\tisEditMode: function() {\n\t\treturn this.editMode;\n\t},\n\tenterEditMode: function() {\n\t\tthis.editMode = true;\n\t\treturn this;\n\t},\n\tleaveEditMode: function() {\n\t\tthis.isAdding() && this.cancelAdding();\n\t\tthis.editMode = false;\n\t\treturn this;\n\t},\n\tstartAdding: function(dummyEvent) {\n\t\tthis.dummyEvent = dummyEvent;\n\t\t// Place on the last mouse position on the timeline\n\t\tif (this.lastPicked) {\n\t\t\tthis.moveDummyEvent(this.lastPicked);\n\t\t\tthis.updateDummyEvent();\n\t\t}\n\t\treturn this.rerenderLocations();\n\t},\n\tcancelAdding: function() {\n\t\tif (this.dummyEvent) {\n\t\t\t// Add the dragged event back on the timeline\n\t\t\tvar draggedEvent = this.dummyEvent.draggedEvent;\n\t\t\tif (draggedEvent) {\n\t\t\t\tthis.addEvent(draggedEvent, {\n\t\t\t\t\tpreserveId: true,\n\t\t\t\t\tupdate: true,\n\t\t\t\t\tallowCollisions: true,\n\t\t\t\t});\n\t\t\t\tvar jqEvent = $.Event('event:dragCanceled.skedtape', {\n\t\t\t\t\tdetail: { event: draggedEvent }\n\t\t\t\t});\n\t\t\t\tthis.$el.trigger(jqEvent, draggedEvent);\n\t\t\t}\n\t\t\t// Delete the dummy\n\t\t\tdelete this.dummyEvent;\n\t\t}\n\t\tif (this.$dummyEvent) {\n\t\t\tthis.$dummyEvent.remove();\n\t\t\tdelete this.$dummyEvent;\n\t\t\tthis.$el.trigger('event:addingCanceled.skedtape');\n\t\t}\n\t\treturn this.rerenderLocations();\n\t},\n\tisAdding: function() {\n\t\treturn !!this.dummyEvent;\n\t},\n\trerenderLocation: function(id) {\n\t\tvar $location = this.$locations.filter(function() {\n\t\t\treturn $(this).data('id') == id;\n\t\t});\n\t\tvar location = this.getLocation(id);\n\t\tif ($location.length && location) {\n\t\t\t$location.replaceWith(this.renderLocation(location));\n\t\t}\n\t},\n\trerenderLocations: function() {\n\t\tthis.$locations.empty().append(this.renderLocations());\n\t\treturn this;\n\t},\n\trenderLocation: function(location) {\n\t\tvar $text = $('<div class=\"sked-tape__location-text\"/>')\n\t\t\t.text(location.name);\n\t\tvar $location = $('<li class=\"sked-tape__location\"/>')\n\t\t\t.attr({'title': location.name, 'data-id': location.id})\n\t\t\t.append($text);\n\t\tvar canAdd = this.isAdding()\n\t\t\t? this.canAddIntoLocation(location, this.dummyEvent)\n\t\t\t: undefined;\n\t\tthis.postRenderLocation($text, location, canAdd);\n\t\treturn $location;\n\t},\n\trenderLocations: function() {\n\t\tvar $frag = $(document.createDocumentFragment());\n\t\t$.each(this.getLocations(), $.proxy(function(i, location) {\n\t\t\tthis.renderLocation(location).appendTo($frag);\n\t\t}, this));\n\t\treturn $frag;\n\t},\n\tpostRenderLocation: function($el, location,  canAdd) {\n\t\tif (canAdd !== undefined) {\n\t\t\t$el.parent()\n\t\t\t\t.toggleClass('sked-tape__location--permitted', canAdd)\n\t\t\t\t.toggleClass('sked-tape__location--forbidden', !canAdd);\n\t\t}\n\t},\n\trenderAside: function() {\n\t\tvar $aside = $('<div class=\"sked-tape__aside\"/>');\n\t\t$('<div class=\"sked-tape__caption\"/>').text(this.caption).appendTo($aside);\n\t\tthis.$locations = $('<ul class=\"sked-tape__locations\"/>')\n\t\t\t.append(this.renderLocations())\n\t\t\t.appendTo($aside);\n\t\tthis.$el.append($aside);\n\t},\n\trenderTimeWrap: function(oldScroll) {\n\t\tvar $hours = this.renderHours();\n\t\tvar $wrap = $('<div class=\"sked-tape__time-wrap\"/>').appendTo(this.$el);\n\t\tthis.$frame = $('<div class=\"sked-tape__time-frame\" tabindex=\"0\"/>')\n\t\t\t.appendTo($wrap);\n\t\tthis.$canvas = $('<div class=\"sked-tape__time-canvas\"/>')\n\t\t\t.append($hours)\n\t\t\t.appendTo(this.$frame);\n\t\toldScroll && this.$frame.scrollLeft(oldScroll);\n\t\tvar $timelineWrap = $('<div class=\"sked-tape__timeline-wrap\"/>')\n\t\t\t.append(this.renderTimeRows())\n\t\t\t.append(this.renderGrid());\n\t\tvar minWidth = this.$canvas[0].scrollWidth;\n\t\tthis.$canvas\n\t\t\t.css('min-width', Math.round(minWidth * this.zoom) + 'px')\n\t\t\t.data('orig-min-width', minWidth)\n\t\t\t.append($timelineWrap)\n\t\t\t.append($hours.clone());\n\t\tif (this.showDates) {\n\t\t\tthis.$canvas.prepend(this.renderDates());\n\t\t}\n\t},\n\trenderDates: function() {\n\t\tvar $ul = $('<ul class=\"sked-tape__dates\"/>');\n\t\tvar firstMidnight = getMidnightAfter(this.start);\n\t\tvar lastMidnight = getMidnightBefore(this.end);\n\t\tvar queue = [];\n\t\tif (firstMidnight > lastMidnight) {\n\t\t\t// The range is within the same day\n\t\t\tqueue.push({weight: 1, text: this.format.date(this.start)})\n\t\t} else {\n\t\t\tqueue.push({\n\t\t\t\tweight: getMsToMidnight(this.start) / MS_PER_DAY,\n\t\t\t\ttext: this.format.date(this.start)\n\t\t\t});\n\t\t\tfor (var day = new Date(firstMidnight); day < lastMidnight;) {\n\t\t\t\tday.setTime(day.getTime() + 1000);\n\t\t\t\tqueue.push({weight: 1, text: this.format.date(day)});\n\t\t\t\tday.setTime(day.getTime() + MS_PER_DAY - 1000);\n\t\t\t}\n\t\t\tqueue.push({\n\t\t\t\tweight: getMsFromMidnight(this.end) / MS_PER_DAY,\n\t\t\t\ttext: this.format.date(this.end)\n\t\t\t});\n\t\t}\n\t\tvar totalWeight = queue.reduce(function(total, item) {\n\t\t\treturn total + item.weight;\n\t\t}, 0);\n\t\tvar duration = this.end.getTime() - this.start.getTime();\n\t\tqueue.forEach(function(item) {\n\t\t\tvar proportion = item.weight / totalWeight;\n\t\t\t$('<li/>')\n\t\t\t\t.css('width', (proportion * 100).toFixed(10) + '%')\n\t\t\t\t.attr('title', item.text)\n\t\t\t\t.addClass('sked-tape__date')\n\t\t\t\t.toggleClass('sked-tape__date--short', proportion * duration <= SHORT_DURATION)\n\t\t\t\t.appendTo($ul);\n\t\t});\n\t\treturn $ul;\n\t},\n\trenderHours: function() {\n\t\tvar $ul = $('<ul/>');\n\n\t\tvar tick = new Date(this.start);\n\t\twhile (tick.getTime() <= this.end.getTime()) {\n\t\t\tvar hour = tick.getHours();\n\n\t\t\tvar $time = $('<time/>')\n\t\t\t\t.attr('datetime', tick.toISOString())\n\t\t\t\t.text(this.format.hours(hour === 24 ? 0 : hour));\n\t\t\t$('<li/>').append($time).appendTo($ul);\n\n\t\t\ttick.setTime(tick.getTime() + 60*60*1000);\n\t\t}\n\n\t\tvar $li = $ul.children();\n\t\t$li.not(':last-child').width(100 / ($li.length - 1) + '%');\n\n\t\treturn $('<div class=\"sked-tape__hours\"/>').append($ul);\n\t},\n\trenderGrid: function() {\n\t\tvar $ul = $('<ul class=\"sked-tape__grid\"/>');\n\t\tvar tick = new Date(this.start);\n\t\twhile (tick.getTime() < this.end.getTime()) {\n\t\t\t$('<li/>').appendTo($ul);\n\t\t\ttick.setTime(tick.getTime() + 60*60*1000);\n\t\t}\n\t\tvar $li = $ul.children();\n\t\t$li.width(100 / $li.length + '%');\n\t\treturn $ul;\n\t},\n\trenderTimeRows: function() {\n\t\tthis.$timeline = $('<ul class=\"sked-tape__timeline\"/>');\n\t\t// Sort the events by time ascending so that the gap between each two of\n\t\t// them may be determined in a cycle.\n\t\tvar events = this.events.sort($.proxy(function(a, b) {\n\t\t\treturn a.start.getTime() - b.start.getTime();\n\t\t}, this));\n\t\tthis.timeIndicators = {};\n\t\t$.each(this.getLocations(), $.proxy(function(i, location) {\n\t\t\tvar $li = $('<li class=\"sked-tape__event-row\"/>')\n\t\t\t\t.data('locationId', location.id)\n\t\t\t\t.appendTo(this.$timeline);\n\t\t\t// Render time indicator\n\t\t\tvar $timeIndicator = $('<div class=\"sked-tape__indicator\"/>').hide();\n\t\t\tif (this.timeIndicatorSerifs)\n\t\t\t\t$timeIndicator.addClass('sked-tape__indicator--serifs');\n\t\t\tthis.timeIndicators[location.id] = $timeIndicator;\n\t\t\t$li.append($timeIndicator);\n\t\t\t// Render events\n\t\t\tvar intersections = this.getIntersections(location.id);\n\t\t\tvar lastEndTime = 0, lastEnd;\n\t\t\tevents.forEach(function(event) {\n\t\t\t\tvar belongs = event.location == location.id;\n\t\t\t\tvar visible = event.end > this.start && event.start < this.end;\n\t\t\t\tif (belongs && visible) {\n\t\t\t\t\tvar intersects = false;\n\t\t\t\t\t$.each(intersections, $.proxy(function(i, intersection) {\n\t\t\t\t\t\t$.each(intersection.events, function(j, jEvent) {\n\t\t\t\t\t\t\tif (jEvent.id == event.id) {\n\t\t\t\t\t\t\t\tintersects = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (intersects) return false;\n\t\t\t\t\t}, this));\n\t\t\t\t\tvar gap = event.start.getTime() - lastEndTime;\n\t\t\t\t\tif (gap >= this.minTimeGapShown && gap <= this.maxTimeGapShown && !intersects) {\n\t\t\t\t\t\t$li.append(this.renderGap(gap, lastEnd, event.start));\n\t\t\t\t\t}\n\t\t\t\t\tlastEnd = event.end;\n\t\t\t\t\tlastEndTime = lastEnd.getTime();\n\t\t\t\t\tvar $event = this.renderEvent(event).appendTo($li);\n\t\t\t\t\tif (this.maxTimeGapHi !== false && gap <= this.maxTimeGapHi) {\n\t\t\t\t\t\t$li.children('.sked-tape__event')\n\t\t\t\t\t\t\t.filter(':eq(-1), :eq(-2)')\n\t\t\t\t\t\t\t.addClass('sked-tape__event--low-gap');\n\t\t\t\t\t}\n\t\t\t\t\telse if (intersects) {\n\t\t\t\t\t\t$event.addClass('sked-tape__event--low-gap');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}, this));\n\t\tthis.renderIntersections();\n\t\treturn this.$timeline;\n\t},\n\trenderIntersections: function() {\n\t\t// Remove the stale ones\n\t\tthis.$timeline.find('.sked-tape__intersection').remove();\n\t\t// Render the new ones\n\t\tthis.$timeline.find('.sked-tape__event-row').each($.proxy(function(i, row) {\n\t\t\tvar $row = $(row);\n\t\t\tvar locationId = $row.data('locationId');\n\t\t\tvar intersections = this.getIntersections(locationId);\n\t\t\t$.each(intersections, $.proxy(function(i, intersection) {\n\t\t\t\tif (intersection.end > this.start && intersection.start < this.end) {\n\t\t\t\t\t$('<div class=\"sked-tape__intersection\"/>')\n\t\t\t\t\t\t.css({\n\t\t\t\t\t\t\twidth: this.computeEventWidth(intersection),\n\t\t\t\t\t\t\tleft: this.computeEventOffset(intersection)\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.data('events', intersection.events)\n\t\t\t\t\t\t.appendTo($row);\n\t\t\t\t}\n\t\t\t}, this));\n\t\t}, this));\n\t},\n\trenderGap: function(gap, start, end) {\n\t\tvar block = {start: start, end: end};\n\t\tvar $text = $('<span class=\"sked-tape__gap-text\"/>')\n\t\t\t.text(Math.round(gap / MS_PER_MINUTE));\n\t\treturn $('<div class=\"sked-tape__gap\"/>')\n\t\t\t.css({\n\t\t\t\twidth: this.computeEventWidth(block),\n\t\t\t\tleft: this.computeEventOffset(block)\n\t\t\t})\n\t\t\t.append($text);\n\t},\n\tfindEventJustBefore: function(event) {\n\t\tvar found = null;\n\t\t$.each(this.events, function(index, iEvent) {\n\t\t\tif (\n\t\t\t\tiEvent.location == event.location &&\n\t\t\t\tiEvent.end < event.start &&\n\t\t\t\t(!found || found.end < iEvent.end)\n\t\t\t) {\n\t\t\t\tfound = iEvent;\n\t\t\t}\n\t\t});\n\t\treturn found;\n\t},\n\tfindEventJustAfter: function(event) {\n\t\tvar found = null;\n\t\t$.each(this.events, function(index, iEvent) {\n\t\t\tif (\n\t\t\t\tiEvent.location == event.location &&\n\t\t\t\tiEvent.start > event.end &&\n\t\t\t\t(!found || found.start > iEvent.start)\n\t\t\t) {\n\t\t\t\tfound = iEvent;\n\t\t\t}\n\t\t});\n\t\treturn found;\n\t},\n\tupdateDummyEvent: function() {\n\t\tif (!this.isAdding()) {\n\t\t\t// Remove its node from the timline\n\t\t\tif (this.$dummyEvent) {\n\t\t\t\tthis.$dummyEvent.remove();\n\t\t\t\tdelete this.$dummyEvent;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t// Create the event if it doesn't exist\n\t\tvar event = this.dummyEvent;\n\t\tif (!this.$dummyEvent) {\n\t\t\tvar timeClass = 'sked-tape__dummy-event-time';\n\t\t\tvar timeClassLeft = timeClass + ' ' + timeClass + '--left';\n\t\t\tvar timeClassRight = timeClass + ' ' + timeClass + '--right';\n\t\t\tthis.$dummyEvent = $('<div/>')\n\t\t\t\t.append('<div class=\"' + timeClassLeft + '\"/>')\n\t\t\t\t.append('<div class=\"' + timeClassRight + '\"/>');\n\t\t}\n\t\tvar $dummyChildren = this.$dummyEvent.children();\n\t\tvar $dummyLeft = $dummyChildren.filter(':first');\n\t\tvar $dummyRight = $dummyChildren.filter(':last');\n\t\t// Apply the className, attributes and styles\n\t\tthis.$dummyEvent[0].className = 'sked-tape__dummy-event ' + (event.className || '');\n\t\tthis.$dummyEvent.css({\n\t\t\twidth: this.computeEventWidth(event),\n\t\t\tleft: this.computeEventOffset(event)\n\t\t});\n\t\tvar leftText = this.format.time(event.start);\n\t\tvar rightText = this.format.time(event.end);\n\t\tif (this.showIntermission) {\n\t\t\tconst prevEvent = this.findEventJustBefore(event);\n\t\t\tvar interval;\n\t\t\tif (prevEvent) {\n\t\t\t\tinterval = Math.round((event.start - prevEvent.end) / MS_PER_MINUTE);\n\t\t\t\tif (\n\t\t\t\t\tinterval >= this.intermissionRange[0] &&\n\t\t\t\t\tinterval <= this.intermissionRange[1]\n\t\t\t\t) {\n\t\t\t\t\tleftText += '<br>+' + this.format.duration(interval * MS_PER_MINUTE);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst nextEvent = this.findEventJustAfter(event);\n\t\t\tif (nextEvent) {\n\t\t\t\tinterval = Math.round((nextEvent.start - event.end) / MS_PER_MINUTE);\n\t\t\t\tif (\n\t\t\t\t\tinterval >= this.intermissionRange[0] &&\n\t\t\t\t\tinterval <= this.intermissionRange[1]\n\t\t\t\t) {\n\t\t\t\t\trightText += '<br>+' + this.format.duration(interval * MS_PER_MINUTE);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$dummyLeft.html(leftText);\n\t\t$dummyRight.html(rightText);\n\t\t// Append to an appropriate location dom node\n\t\tvar $eventRow = this.$dummyEvent.closest('.sked-tape__event-row');\n\t\tif (!$eventRow.length || $eventRow.data('locationId') != event.location) {\n\t\t\tthis.$dummyEvent.remove();\n\t\t\t$eventRow = this.$el.find('.sked-tape__event-row').filter(function() {\n\t\t\t\treturn $(this).data('locationId') == event.location;\n\t\t\t});\n\t\t\tif ($eventRow.length) {\n\t\t\t\tthis.$dummyEvent.appendTo($eventRow);\n\t\t\t}\n\t\t}\n\t},\n\tupdateEvent: function(eventId) {\n\t\tvar event = this.getEvent(eventId);\n\t\tvar $oldEvent = this.$timeline\n\t\t\t.find('.sked-tape__event')\n\t\t\t.filter(function() {\n\t\t\t\treturn $(this).data('eventId') == eventId;\n\t\t\t});\n\t\tif (event && $oldEvent.length) {\n\t\t\tvar $newEvent = this.renderEvent(event);\n\t\t\t$oldEvent.replaceWith($newEvent);\n\t\t} else {\n\t\t\t// Adding an event (or removal one of them) entails rendering some\n\t\t\t// other entities like time markers between events. We don't\n\t\t\t// bother with that here and just rerender the entire component.\n\t\t\tthis.update();\n\t\t}\n\t},\n\trenderEvent: function(event) {\n\t\t// Create event node\n\t\tif (event.url && !event.disabled) {\n\t\t\tvar $event = $('<a/>').attr('href', event.url);\n\t\t} else {\n\t\t\tvar $event = $('<div/>');\n\t\t}\n\t\t$event.addClass('sked-tape__event');\n\t\tif (event.className) {\n\t\t\t$event.addClass(event.className);\n\t\t}\n\t\t$event\n\t\t\t.toggleClass('sked-tape__event--disabled', !!event.disabled)\n\t\t\t.toggleClass('sked-tape__event--active', !!event.active)\n\t\t\t.attr('title', event.name)\n\t\t\t.css({\n\t\t\t\twidth: this.computeEventWidth(event),\n\t\t\t\tleft: this.computeEventOffset(event)\n\t\t\t});\n\t\t// Append the center aligner node with text context\n\t\tvar $center = $('<div class=\"sked-tape__center\"/>')\n\t\t\t.text(event.name)\n\t\t\t.appendTo($event);\n\t\tif (this.showEventTime || this.showEventDuration) {\n\t\t\tvar html = $center.html();\n\t\t\tvar duration = this.format.roundDuration(event.end - event.start);\n\t\t\tif (this.showEventTime) {\n\t\t\t\thtml += '<br>' + this.format.time(event.start)\n\t\t\t\t\t+ ' - ' + this.format.time(new Date(event.start.getTime() + duration));\n\t\t\t}\n\t\t\tif (this.showEventDuration) {\n\t\t\t\thtml += '<br>' + this.format.duration(duration);\n\t\t\t}\n\t\t\t$center.html(html);\n\t\t}\n\t\t// Bind data-*\n\t\t$event.data($.extend({}, {eventId: event.id}, event.data));\n\t\t// Measure minimum content width to detect whether to attach popover further\n\t\tvar $loose = $event.clone()\n\t\t\t.css({\n\t\t\t\twidth: '',\n\t\t\t\tleft: '-10000px',\n\t\t\t\ttop: '-10000px'\n\t\t\t})\n\t\t\t.appendTo(document.body);\n\t\t$event.data('min-width', $loose.outerWidth());\n\t\t$loose.remove();\n\t\t// Execute the hook\n\t\tthis.postRenderEvent($event, event);\n\n\t\treturn $event;\n\t},\n\tcomputeEventWidth: function(event) {\n\t\t// Clamp to timeline edge\n\t\tvar eventEnd = this.end < event.end ? this.end : event.end;\n\t\tvar durationHours = getDurationHours(event.start, eventEnd);\n\t\treturn durationHours / getDurationHours(this.start, this.end) * 100 + '%';\n\t},\n\tcomputeEventOffset: function(event) {\n\t\tvar hoursBeforeEvent =  getDurationHours(this.start, event.start);\n\t\treturn hoursBeforeEvent /  getDurationHours(this.start, this.end) * 100 + '%';\n\t},\n\tupdateTimeIndicatorsPos: function() {\n\t\tvar start = this.start.getTime();\n\t\tvar end = this.end.getTime();\n\t\tvar utcNow = new Date().getTime();\n\t\tObject.keys(this.timeIndicators).forEach(function(locationId) {\n\t\t\tvar location = this.getLocation(locationId);\n\t\t\tvar tzOffset = location.tzOffset === undefined ? this.tzOffset : location.tzOffset;\n\t\t\tvar tzDiff = tzOffset - CURRENT_TZ_OFFSET;\n\t\t\tvar now = utcNow - tzDiff * MS_PER_MINUTE;\n\t\t\tvar $timeIndicator = this.timeIndicators[locationId];\n\t\t\tif (now >= start && now <= end) {\n\t\t\t\tvar offset = 100 * (now - start) / (end - start) + '%';\n\t\t\t\t$timeIndicator.show().css('left', offset);\n\t\t\t} else {\n\t\t\t\t$timeIndicator.hide();\n\t\t\t}\n\t\t}, this);\n\t},\n\t/**\n\t * A helper might be required by the client to find out whether the tape\n\t * has intersecting events.\n\t */\n\thasIntersections: function() {\n\t\tvar eventA, eventB, j;\n\t\tfor (var i = 0; i < this.events.length; i++) {\n\t\t\teventA = this.events[i];\n\t\t\tfor (j = i + 1; j < this.events.length; j++) {\n\t\t\t\teventB = this.events[j];\n\t\t\t\tif (\n\t\t\t\t\teventA.location === eventB.location &&\n\t\t\t\t\tfindIntersection(eventA, eventB)\n\t\t\t\t) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\t/**\n\t * Returns event intersection list for a specified location.\n\t */\n\tgetIntersections: function(location) {\n\t\tvar intersections = [];\n\t\tvar occupied = function(intersection) {\n\t\t\tfor (var i = 0; i < intersections.length; ++i) {\n\t\t\t\tif (intersection.start.getTime() == intersections[i].start.getTime() &&\n\t\t\t\t\tintersection.end.getTime() == intersections[i].end.getTime()) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t\t$.each(this.events, $.proxy(function(i, iEvent) {\n\t\t\tif (iEvent.location != location) {\n\t\t\t\treturn; // Skip all the events of the other locations\n\t\t\t}\n\t\t\tfor (var j = i + 1; j < this.events.length; ++j) {\n\t\t\t\tvar jEvent = this.events[j];\n\t\t\t\tif (jEvent.location != location) {\n\t\t\t\t\tcontinue; // Skip all the events of the other locations\n\t\t\t\t}\n\t\t\t\tvar intersection = findIntersection(iEvent, jEvent);\n\t\t\t\tif (intersection && !occupied(intersection)) {\n\t\t\t\t\t// Intersection found and the exact time\n\t\t\t\t\t// is unique (for rendering optimization purposes)\n\t\t\t\t\tintersection.events = [iEvent, jEvent];\n\t\t\t\t\tintersections.push(intersection);\n\t\t\t\t}\n\t\t\t}\n\t\t}, this));\n\t\treturn intersections;\n\t},\n\tdestroy: function() {\n\t\tthis.cleanup();\n\t\tthis.$el.off().empty().removeClass('sked-tape sked-tape--has-dates');\n\t},\n\tcleanup: function() {\n\t\tif ($.fn.popover) {\n\t\t\tthis.$el.find('.sked-tape__event')\n\t\t\t\t.popover(TWBS_MAJOR >= 4 ? 'dispose' : 'destroy');\n\t\t}\n\t\tif (this.indicatorTimeout) {\n\t\t\tclearInterval(this.indicatorTimeout);\n\t\t\tdelete this.indicatorTimeout;\n\t\t}\n\t},\n\trender: function(opts) {\n\t\tvar oldScrollLeft = opts && opts.preserveScroll\n\t\t\t&& this.$frame && this.$frame.scrollLeft();\n\n\t\tthis.cleanup();\n\t\tthis.$el.empty().addClass('sked-tape');\n\t\tif (this.showDates) {\n\t\t\tthis.$el.addClass('sked-tape--has-dates');\n\t\t}\n\n\t\tthis.renderAside();\n\t\tthis.renderTimeWrap(oldScrollLeft);\n\t\tthis.updateTimeIndicatorsPos();\n\n\t\tthis.indicatorTimeout = setInterval($.proxy(function() {\n\t\t\tthis.updateTimeIndicatorsPos();\n\t\t}, this), 1000);\n\n\t\tsetTimeout($.proxy(function() {\n\t\t\tvar bodyClass = TWBS_MAJOR >= 4 ? 'body' : 'content';\n\t\t\tvar template = '<div class=\"popover\" role=\"tooltip\">' +\n\t\t\t\t'<div class=\"arrow\"></div>' +\n\t\t\t\t'<div class=\"popover-' + bodyClass + '\"></div>' +\n\t\t\t'</div>';\n\t\t\tthis.$el.find('.sked-tape__event').each($.proxy(function(i, el) {\n\t\t\t\tvar $entry = $(el);\n\t\t\t\tvar tooSmall = $entry.width() < $entry.data('min-width');\n\t\t\t\tvar left = parseFloat($entry[0].style.left);\n\t\t\t\tvar right = left + parseFloat($entry[0].style.width);\n\t\t\t\tvar TOLERANCE = 0.01;\n\t\t\t\tvar overflows = left < -TOLERANCE || right > 100 + TOLERANCE;\n\t\t\t\tif ($.fn.popover && (tooSmall || overflows)) {\n\t\t\t\t\t$entry.popover({\n\t\t\t\t\t\ttrigger: 'hover',\n\t\t\t\t\t\tcontent: $entry.find('.sked-tape__center').html(),\n\t\t\t\t\t\thtml: true,\n\t\t\t\t\t\ttemplate: template,\n\t\t\t\t\t\tplacement: left < 50 ? 'right' : 'left'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, this));\n\t\t}, this), 0);\n\n\t\treturn this;\n\t},\n\tupdate: function() {\n\t\treturn this.render({preserveScroll: true});\n\t},\n\tupdateUnlessOption: function(opts) {\n\t\tvar requested = !opts || opts.update === undefined || opts.update;\n\t\treturn (this.$timeline && requested) ? this.update() : this;\n\t},\n\tsetSnapToMins: function(mins) {\n\t\tthis.snapToMins = mins;\n\t},\n\tfindEventsAtTime: function(date, locationId) {\n\t\tvar time = date.getTime();\n\t\tvar events = [];\n\t\t$.each(this.getEvents(), function(i, event) {\n\t\t\tif (event.location == locationId &&\n\t\t\t\tevent.start.getTime() <= time && event.end.getTime() >= time) {\n\t\t\t\tevents.push(event);\n\t\t\t}\n\t\t});\n\t\treturn events;\n\t},\n\tpick: function(e) {\n\t\tvar scalar = (e.pageX - this.$timeline.offset().left) / this.$timeline.width();\n\t\tvar time = this.start.getTime() + scalar * (this.end.getTime() - this.start.getTime());\n\t\tvar locationId;\n\t\tthis.$el.find('.sked-tape__event-row').each(function() {\n\t\t\tvar top = $(this).offset().top;\n\t\t\tvar bottom = top + $(this).height();\n\t\t\tif (e.pageY >= top && e.pageY <= bottom) {\n\t\t\t\tlocationId = $(this).data('locationId');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\tlocationId: locationId,\n\t\t\tdate: new Date(Math.round(time))\n\t\t};\n\t},\n\tmakeMouseEvent: function(type, e, props) {\n\t\treturn $.Event(type, $.extend({}, props, {\n\t\t\trelatedTarget: e.currentTarget,\n\t\t\tclientX: e.clientX,\n\t\t\tclientY: e.clientY,\n\t\t\toffsetX: e.offsetX,\n\t\t\toffsetY: e.offsetY,\n\t\t\tpageX: e.pageX,\n\t\t\tpageY: e.pageY,\n\t\t\tscreenX: e.screenX,\n\t\t\tscreenY: e.screenY,\n\t\t\tdetail: $.extend(this.pick(e), props.detail)\n\t\t}));\n\t},\n\tdragEvent: function(eventId, e) {\n\t\te = e || {};\n\t\t// Skip if some event is being dragged right now\n\t\tif (this.isAdding()) return;\n\t\tvar event = this.getEvent(eventId);\n\t\t// Make sure the event is allowed to be draggable\n\t\tvar jqEvent = this.makeMouseEvent('event:dragStart.skedtape', e, {\n\t\t\tdetail: { component: this, event: event }\n\t\t});\n\t\tthis.$el.trigger(jqEvent, [this]);\n\t\tif (!jqEvent.isDefaultPrevented()) {\n\t\t\t// Emit an event delete event\n\t\t\tvar jqEvent = this.makeMouseEvent('event:dragStarted.skedtape', e, {\n\t\t\t\tdetail: { component: this, event: event }\n\t\t\t});\n\t\t\tthis.$el.trigger(jqEvent, [this]);\n\t\t\t// Remove it from the timeline and begin positioning\n\t\t\tthis.removeEvent(eventId);\n\t\t\tthis.startAdding({\n\t\t\t\tid: event.id,\n\t\t\t\tname: event.name,\n\t\t\t\tduration: event.end.getTime() - event.start.getTime(),\n\t\t\t\tuserData: $.extend({}, event.userData || {}),\n\t\t\t\tdraggedEvent: event\n\t\t\t});\n\t\t}\n\t},\n\thandleEventClick: function(e) {\n\t\tvar eventId = $(e.currentTarget).data('eventId');\n\t\tvar event = this.getEvent(eventId);\n\t\tif (this.isEditMode()) {\n\t\t\tthis.dragEvent(eventId, e);\n\t\t} else {\n\t\t\t// Emit an event click event\n\t\t\tvar jqEvent = this.makeMouseEvent('event:click.skedtape', e, {\n\t\t\t\tdetail: { component: this, event: event }\n\t\t\t});\n\t\t\tthis.$el.trigger(jqEvent, [this]);\n\t\t}\n\t},\n\thandleEventContextMenu: function(e) {\n\t\te.preventDefault();\n\t\tif (this.rmbCancelsAdding && this.isAdding()) {\n\t\t\treturn this.cancelAdding();\n\t\t}\n\t\tvar eventId = $(e.currentTarget).data('eventId');\n\t\tvar event = this.getEvent(eventId);\n\t\tvar jqEvent = this.makeMouseEvent('event:contextmenu.skedtape', e, {\n\t\t\tdetail: { component: this, event: event }\n\t\t});\n\t\tthis.$el.trigger(jqEvent, [this]);\n\t},\n\thandleIntersectionClick: function(e) {\n\t\tvar jqEvent = this.makeMouseEvent('intersection:click.skedtape', e, {\n\t\t\tdetail: { component: this }\n\t\t});\n\t\tvar detail = jqEvent.detail;\n\t\tdetail.events = this.findEventsAtTime(detail.date, detail.locationId);\n\t\tthis.$el.trigger(jqEvent, [this]);\n\t},\n\thandleIntersectionContextMenu: function(e) {\n\t\te.preventDefault();\n\t\tif (this.rmbCancelsAdding && this.isAdding()) {\n\t\t\treturn this.cancelAdding();\n\t\t}\n\t\tvar jqEvent = this.makeMouseEvent('intersection:contextmenu.skedtape', e, {\n\t\t\tdetail: { component: this }\n\t\t});\n\t\tvar detail = jqEvent.detail;\n\t\tdetail.events = this.findEventsAtTime(detail.date, detail.locationId);\n\t\tthis.$el.trigger(jqEvent, [this]);\n\t},\n\tcompleteAdding: function(e) {\n\t\tvar event = this.dummyEvent;\n\t\t// Check for collisions\n\t\tif (this.collide(event)) {\n\t\t\tvar jqEvent = this.makeMouseEvent('event:dragEndRefused.skedtape', e, {\n\t\t\t\tdetail: { component: this, event: event }\n\t\t\t});\n\t\t\tthis.$el.trigger(jqEvent, [this]);\n\t\t\treturn;\n\t\t}\n\t\t// Emit the event coming before actual addition\n\t\tvar jqEvent = this.makeMouseEvent('event:dragEnd.skedtape', e, {\n\t\t\tdetail: { component: this, event: event }\n\t\t});\n\t\tthis.$el.trigger(jqEvent, [this]);\n\t\t// Add event if the operation hasn't been canceled by any event handler\n\t\tif (!jqEvent.isDefaultPrevented()) {\n\t\t\t// At this step there something may have changed by\n\t\t\t// the callback above, so do the collision check again.\n\t\t\ttry {\n\t\t\t\tvar newEvent = this.addEvent(event, {preserveId: true, update: true});\n\t\t\t\tdelete event.duration;\n\t\t\t\tdelete this.dummyEvent;\n\t\t\t\tthis.$dummyEvent.remove();\n\t\t\t\tdelete this.$dummyEvent;\n\t\t\t\tvar jqEvent = this.makeMouseEvent('event:dragEnded.skedtape', e, {\n\t\t\t\t\tdetail: { component: this, event: newEvent }\n\t\t\t\t});\n\t\t\t\tthis.$el.trigger(jqEvent, [this]);\n\t\t\t\tthis.rerenderLocations();\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tif (e.name !== 'SkedTape.CollisionError') {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t\tvar jqEvent = this.makeMouseEvent('event:dragEndRefused.skedtape', e, {\n\t\t\t\t\tdetail: { component: this, event: event }\n\t\t\t\t});\n\t\t\t\tthis.$el.trigger(jqEvent, [this]);\n\t\t\t}\n\t\t}\n\t},\n\thandleTimelineClick: function(e) {\n\t\tif (eventFromEvent(e)) return;\n\t\tif (this.isAdding()) {\n\t\t\tif (this.dummyEvent.location) {\n\t\t\t\tthis.completeAdding(e);\n\t\t\t}\n\t\t} else {\n\t\t\tvar jqEvent = this.makeMouseEvent('timeline:click.skedtape', e, {\n\t\t\t\tdetail: { component: this }\n\t\t\t});\n\t\t\tthis.$el.trigger(jqEvent, [this]);\n\t\t}\n\t},\n\thandleTimelineContextMenu: function(e) {\n\t\tif (eventFromEvent(e)) return;\n\t\te.preventDefault();\n\t\tif (this.rmbCancelsAdding && this.isAdding()) {\n\t\t\treturn this.cancelAdding();\n\t\t}\n\t\tvar jqEvent = this.makeMouseEvent('timeline:contextmenu.skedtape', e, {\n\t\t\tdetail: { component: this }\n\t\t});\n\t\tthis.$el.trigger(jqEvent, [this]);\n\t},\n\t/**\n\t * Mutates dummyEvent to conform a position info.\n\t *\n\t * @param {object} picked The position info returned by the pick() function.\n\t */\n\tmoveDummyEvent: function(picked) {\n\t\tvar event = this.dummyEvent;\n\t\tvar start = picked.date;\n\t\tif (this.snapToMins) {\n\t\t\tvar hr = floorHours(start);\n\t\t\tvar left = (start.getTime() - hr.getTime()) / MS_PER_MINUTE;\n\t\t\tvar lower = Math.floor(left / this.snapToMins) * this.snapToMins;\n\t\t\tvar min = left - lower < this.snapToMins / 2 ? lower : lower + this.snapToMins;\n\t\t\tstart = new Date(hr.getTime() + Math.round(min * MS_PER_MINUTE));\n\t\t}\n\t\t$.extend(event, {\n\t\t\tstart: start,\n\t\t\tend: new Date(start.getTime() + event.duration)\n\t\t});\n\t\tif (picked.locationId) {\n\t\t\tvar location = this.getLocation(picked.locationId);\n\t\t\tif (this.canAddIntoLocation(location, event)) {\n\t\t\t\tthis.beforeAddIntoLocation(location, event);\n\t\t\t\tevent.location = picked.locationId;\n\t\t\t}\n\t\t}\n\t},\n\thandleMouseMove: function(e) {\n\t\tthis.lastPicked = this.pick(e);\n\t\tif (!this.isAdding()) return;\n\t\tthis.moveDummyEvent(this.lastPicked);\n\t\tthis.updateDummyEvent();\n\t},\n\thandleKeyDown: function(e) {\n\t\tif (e.key === '+') {\n\t\t\tthis.zoomIn();\n\t\t}\n\t\telse if (e.key === '-') {\n\t\t\tthis.zoomOut();\n\t\t}\n\t},\n\thandleWheel: function(e) {\n\t\tif (e.ctrlKey) {\n\t\t\tif (e.originalEvent.deltaY < 0) {\n\t\t\t\tthis.zoomIn();\n\t\t\t} else {\n\t\t\t\tthis.zoomOut();\n\t\t\t}\n\t\t\treturn false;\n\t\t} else if (!e.shiftKey && this.scrollWithYWheel) {\n\t\t\tvar delta = e.originalEvent.deltaY > 0 ? 1 : -1;\n\t\t\tdelta *= this.$frame.width() * 0.9;\n\t\t\tif (this.$frame.queue().length) {\n\t\t\t\tvar scrollLeft = this.$frame.scrollLeft();\n\t\t\t\tdelta += this.$frame.finish().scrollLeft() - scrollLeft;\n\t\t\t\tthis.$frame.scrollLeft(scrollLeft);\n\t\t\t}\n\t\t\tthis.$frame.animate({ scrollLeft: '+=' + delta }, 200);\n\t\t\treturn false;\n\t\t}\n\t}\n};\n\nSkedTape.CollisionError = function(id) {\n\tthis.message = 'Collision with entry #' + id;\n\tthis.eventId = id;\n\t// Use V8's native method if available, otherwise fallback\n\tif (\"captureStackTrace\" in Error)\n\t\tError.captureStackTrace(this, SkedTape.CollisionError);\n\telse\n\t\tthis.stack = (new Error()).stack;\n}\nSkedTape.CollisionError.prototype = Object.create(Error.prototype);\nSkedTape.CollisionError.prototype.name = \"SkedTape.CollisionError\";\nSkedTape.CollisionError.prototype.constructor = SkedTape.CollisionError;\n\nvar TWBS_MAJOR = $.fn.popover ? parseInt($.fn.popover.Constructor.VERSION.charAt(0), 10) : 0;\nvar SECS_PER_DAY = 24 * 60 * 60;\nvar MS_PER_DAY = SECS_PER_DAY * 1000;\nvar MS_PER_MINUTE = 60 * 1000;\nvar MS_PER_HOUR = 60 * MS_PER_MINUTE;\nvar SHORT_DURATION = 2 * MS_PER_HOUR - 1; // < this ? .sked-tape__date--short\n\nfunction eventFromEvent(e) {\n\treturn !!$(e.target).closest('.sked-tape__event, .sked-tape__intersection').length;\n}\nfunction isValidTimeRange(start, end) {\n\tvar correctTypes = start instanceof Date && end instanceof Date;\n\tvar correctOrder = start <= end;\n\treturn correctTypes && correctOrder;\n}\nfunction getDurationHours(start, end) {\n\treturn (end.getTime() - start.getTime()) / 1000 / 60 / 60;\n}\nfunction getMsFromMidnight(d) {\n\tvar secs = d.getHours()*60*60 + d.getMinutes()*60 + d.getSeconds();\n\treturn secs * 1000 + d.getMilliseconds();\n}\nfunction getMsToMidnight(d) {\n\treturn MS_PER_DAY - getMsFromMidnight(d);\n}\nfunction getMidnightAfter(d) {\n\td = new Date(d);\n\td.setTime(d.getTime() + getMsToMidnight(d));\n\treturn d;\n}\nfunction getMidnightBefore(d) {\n\td = new Date(d);\n\td.setTime(d.getTime() - getMsFromMidnight(d));\n\treturn d;\n}\nfunction gapBetween(a, b) {\n\tvar min = a.start < b.start  ? a : b;\n\tvar max = min === a ? b : a;\n\treturn max.start - min.end;\n}\nfunction floorHours(date) {\n\tvar floor = new Date(date);\n\tfloor.setHours(date.getHours(), 0, 0, 0);\n\treturn floor;\n}\nfunction ceilHours(date) {\n\tvar floor = floorHours(date);\n\tif (floor < date) { // not equal\n\t\tfloor.setTime(floor.getTime() + MS_PER_HOUR);\n\t}\n\treturn floor;\n}\n\n// ---------------------------- jQuery plugin ----------------------------------\n\n$.fn.skedTape = function(opts) {\n\tvar cmd = opts && (typeof opts === 'string' || opts instanceof String) ? opts : '';\n\topts = opts && !cmd && typeof opts === 'object' ? $.extend({}, opts) : {};\n\tvar args = cmd ? Array.prototype.slice.call(arguments, 1) : [];\n\treturn this.each(function() {\n\t\tvar obj = $(this).data($.fn.skedTape.dataKey);\n\t\tif (!obj || !cmd) {\n\t\t\tif (cmd) {\n\t\t\t\tthrow new Error('SkedTape plugin hadn\\'t been initialized but used');\n\t\t\t}\n\t\t\tif (obj) {\n\t\t\t\tobj.destroy();\n\t\t\t}\n\t\t\tvar objOpts = $.extend({}, $.fn.skedTape.defaults, opts, {\n\t\t\t\tel: this\n\t\t\t});\n\t\t\tdelete objOpts.locations;\n\t\t\tdelete objOpts.events;\n\t\t\tdelete objOpts.start;\n\t\t\tdelete objOpts.end;\n\t\t\tdelete objOpts.deferRender;\n\t\t\tobj = new SkedTape(objOpts);\n\t\t\topts.start && opts.end && obj.setTimespan(opts.start, opts.end, {update: false});\n\t\t\topts.locations && obj.setLocations(opts.locations, {update: false});\n\t\t\topts.events && obj.setEvents(opts.events, {update: false, allowCollisions: true});\n\t\t\t$(this).data($.fn.skedTape.dataKey, obj);\n\t\t\topts.deferRender || obj.render();\n\t\t} else {\n\t\t\tswitch (cmd) {\n\t\t\t\tcase 'destroy':\n\t\t\t\t\tobj.destroy();\n\t\t\t\t\t$(this).removeData($.fn.skedTape.dataKey);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tvar methods = [\n\t\t\t\t\t\t'addEvent',  'addEvents', 'removeEvent', 'setEvents',\n\t\t\t\t\t\t'removeAllEvents', 'enterEditMode', 'leaveEditMode',\n\t\t\t\t\t\t'startAdding', 'cancelAdding', 'setLocations',\n\t\t\t\t\t\t'addLocation', 'addLocations', 'removeLocation',\n\t\t\t\t\t\t'setTimespan', 'setDate', 'zoomIn', 'zoomOut', 'setZoom',\n\t\t\t\t\t\t'resetZoom', 'render', 'setSnapToMins', 'dragEvent',\n\t\t\t\t\t\t'updateEvent',\n\t\t\t\t\t];\n\t\t\t\t\tif (methods.indexOf(cmd) >= 0) {\n\t\t\t\t\t\tobj[cmd].apply(obj, args);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error('SkedTape plugin cannot recognize command');\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nfunction findIntersection(a, b) {\n\tvar min = a.start < b.start  ? a : b;\n\tvar max = min == a ? b : a;\n\n\t//min ends before max starts -> no intersection\n\tif (min.end < max.start) {\n\t\treturn null;\n\t}\n\n\treturn {\n\t\tstart: max.start,\n\t\tend: min.end < max.end ? min.end : max.end\n\t};\n}\n\n$.fn.skedTape.dataKey = 'sked-tape';\n$.fn.skedTape.format = SkedTape.defaultFormatters;\n\n$.fn.skedTape.defaults = {\n\tcaption: '',\n\tmaxZoom: 10,\n\t/**\n\t * Default zooming up and down increment/decrement value.\n\t */\n\tzoomStep: 0.5,\n\t/**\n\t * Initial zoom level. Minimum possible value is 1.\n\t */\n\tzoom: 1,\n\t/**\n\t * Whether to show from-to dates in events.\n\t */\n\tshowEventTime: false,\n\t/**\n\t * Whether to show duration in events.\n\t */\n\tshowEventDuration: false,\n\t/**\n\t * Whether to show dates bar.\n\t */\n\tshowDates: true,\n\t/**\n\t * Minimum time between events required for the user to be able to add an event.\n\t */\n\tminGapTimeBetween: 0,\n\t/**\n\t * Minimum gap between events to show minutes.\n\t */\n\tminTimeGapShown: 1 * MS_PER_MINUTE,\n\t/**\n\t * Maximum gap between events to show minutes.\n\t */\n\tmaxTimeGapShown: 60 * MS_PER_MINUTE - 1,\n\t/**\n\t * Minimum gap to DO NOT highlight adjacent events.\n\t */\n\tmaxTimeGapHi: false,\n\t/**\n\t * Enables horizontal timeline scrolling with vertical mouse wheel.\n\t */\n\tscrollWithYWheel: false,\n\t/**\n\t * Enables sorting of locations.\n\t */\n\tsorting: false,\n\t/**\n\t * Specifies sorting columns. The property accepts two possible values:\n\t * 'order' (sorting by the property 'order' provided in location objects)\n\t * or 'name' (locale-aware case insensitive comparison by name).\n\t */\n\torderBy: 'order',\n\t/**\n\t * The number of minutes the dummy event will be snapped to. To\n\t * disable snapping set any falsy value.\n\t */\n\tsnapToMins: 1,\n\t/**\n\t * Right Mouse Button cancels adding a new event.\n\t */\n\trmbCancelsAdding: true,\n\t/**\n\t * Default timezone for locations, takes effect when you don't specify it\n\t * in location descriptor. The default value is a browser's current timezone.\n\t */\n\ttzOffset: CURRENT_TZ_OFFSET,\n\t/**\n\t * Enables or disables showing serifs on time indicator lines.\n\t */\n\ttimeIndicatorSerifs: false,\n\t/**\n\t * Enables or disables showing intervals between events.\n\t */\n\tshowIntermission: false,\n\t/**\n\t * Interval (in minutes) between events to show intermission time when it is\n\t * enabled.\n\t */\n\tintermissionRange: [1, 60],\n\t/**\n\t * The hook invoked to determine whether an event may be added to a location.\n\t * The default implementation always returns *true*.\n\t * You should avoid mutating the arguments in this hook (that may cause\n\t * unexpected behaviour).\n\t * \n\t * @see beforeAddIntoLocation()\n\t */\n\tcanAddIntoLocation: function(location, event) { return true; },\n\t/**\n\t * Invoked after getting a positive result from the `canAddIntoLocation()`\n\t * hook just before updating the event. Here you can place any logic that\n\t * mutates the event object given.\n\t * \n\t * @see canAddIntoLocation()\n\t */\n\tbeforeAddIntoLocation: function(location, event) {},\n\t/**\n\t * The mixin is applied to every location's DOM element when rendering the sidebar.\n\t * The callback takes 3 arguments: jQuery text element node representing\n\t * the location, the corresponding location object and a boolean value\n\t * specifying the result of executing the `canAddIntoLocation()` function on\n\t * the location and dummy event.\n\t * The value of the last argument is undefined if the function is called\n\t * while no event is being dragged.\n\t */\n\tpostRenderLocation: function($el, location, canAdd) {\n\t\tSkedTape.prototype.postRenderLocation.call(this, $el, location, canAdd);\n\t},\n\t/**\n\t * The mixin applied to every event DOM element on the timeline after\n\t * rendering is complete and before actual inserting to the DOM tree of the\n\t * document. The default implementation does nothing, you may feel free to\n\t * replace it with your own code that modifies the default representation of\n\t * events on a timeline.\n\t */\n\tpostRenderEvent: function($event, event) {},\n};\n\n$.skedTape = function(opts) {\n\treturn $('<div/>').skedTape($.extend({}, opts || {}, {deferRender: true}));\n};\n"]}
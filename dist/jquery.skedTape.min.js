/**
 * jQuery.skedTape v2.5.0
 * License: MIT
 * Author: Alexander Korostin <lexkrstn@gmail.com>
 */

!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,i){return void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(i),i}:t(jQuery)}((function(t){var e=(new Date).getTimezoneOffset(),i=function(e){t.extend(this,e),this.$el=e&&e.el?t(e.el):t("<div/>"),this.el=e.el instanceof t?e.el[0]:e.el,this.locations=[],this.events=[],this.lastEventId=0,this.format=t.extend({},i.defaultFormatters,e&&e.formatters||{}),this.$el.on("click",".sked-tape__event",t.proxy(this.handleEventClick,this)),this.$el.on("contextmenu",".sked-tape__event",t.proxy(this.handleEventContextMenu,this)),this.$el.on("click",".sked-tape__timeline-wrap",t.proxy(this.handleTimelineClick,this)),this.$el.on("contextmenu",".sked-tape__timeline-wrap",t.proxy(this.handleTimelineContextMenu,this)),this.$el.on("mousemove",".sked-tape__timeline-wrap",t.proxy(this.handleMouseMove,this)),this.$el.on("keydown",".sked-tape__time-frame",t.proxy(this.handleKeyDown,this)),this.$el.on("wheel",".sked-tape__time-frame",t.proxy(this.handleWheel,this)),this.$el.on("click",".sked-tape__intersection",t.proxy(this.handleIntersectionClick,this)),this.$el.on("contextmenu",".sked-tape__intersection",t.proxy(this.handleIntersectionContextMenu,this))};i.defaultFormatters={date:function(t,e,i){e=e||"m",i=i||("m"===e?"/":".");var n=[t.getDate(),t.getMonth()+1,t.getFullYear()];return"m"===e&&(n=[n[1],n[0],n[2]]),n.join(i)},roundDuration:function(t){return t},duration:function(t,e){var i=Math.floor(t/r),n=Math.floor(t%r/a),s=e&&e.hrs||"hrs",o=e&&e.min||"min",d=i?i+s:"";return d+=i&&n?" ":"",d+=n?n+o:""},hours:function(t){return(t<10?"0":"")+t+":00"},time:function(t){var e=t.getHours(),i=t.getMinutes();return(e<10?"0"+e:e)+":"+(i<10?"0"+i:i)}},i.prototype={constructor:i,setTimespan:function(t,e,i){if(!h(t,e))throw new Error("Invalid time range: "+JSON.stringify([t,e]));return this.start=m(t),this.end=function(t){var e=m(t);e<t&&e.setTime(e.getTime()+r);return e}(e),this.updateUnlessOption(i)},setDate:function(t,e,i){var n=new Date(t);n.setHours(0,0,0,0);var a=new Date(n);if(a.setHours(e||0),i&&24!=i)(r=new Date(n.getTime())).setHours(i);else var r=new Date(n.getTime()+s);return this.setTimespan(a,r)},getZoom:function(){return this.zoom},setZoom:function(t){if((t=t||1)<1)return this.zoom=1,this;if(t>this.maxZoom)return this.zoom=this.maxZoom,this;if(this.zoom=t,this.$canvas){var e=this.$canvas.data("orig-min-width")*t;this.$canvas.css("min-width",Math.round(e)+"px")}return this},resetZoom:function(){return this.setZoom()},zoomIn:function(t){return this.setZoom(this.zoom+(t||this.zoomStep))},zoomOut:function(t){return this.setZoom(this.zoom-(t||this.zoomStep))},locationExists:function(e){var i=!1;return t.each(this.locations,(function(t,n){if(n.id==e)return i=!0,!1})),i},setLocations:function(e,i){return this.events=[],this.locations=e&&e.map((function(e){return{id:e.id,name:e.name,order:e.order||0,tzOffset:e.tzOffset,userData:e.userData?t.extend({},e.userData):{}}})),this.updateUnlessOption(i)},addLocations:function(t,e){return this.locations=this.locations.concat(t),this.updateUnlessOption(e)},addLocation:function(t,e){return this.locations.push(t),this.updateUnlessOption(e)},removeLocation:function(t,e){for(var i=this.events.length-1;i>=0;--i)this.events[i].location==t&&this.events.splice(i,1);for(i=0;i<this.locations.length;++i)if(this.locations[i].id==t){this.locations.splice(i,1);break}return this.updateUnlessOption(e)},getLocation:function(t){for(var e=0;e<this.locations.length;++e)if(this.locations[e].id==t)return this.locations[e];return null},getLocations:function(){var t=this.locations;return this.sorting&&"name"===this.orderBy?t=t.sort((function(t,e){return t=t.name.toLocaleLowerCase(),e=e.name.toLocaleLowerCase(),t.localeCompare(e)})):this.sorting&&"order"===this.orderBy&&(t=t.sort((function(t,e){return(t.order||0)-(e.order||0)}))),t},collide:function(t){for(var e=0;e<this.events.length;++e)if(t.location==this.events[e].location&&(i=t,n=this.events[e],s=void 0,void 0,s=i.start<n.start?i:n,(s===i?n:i).start-s.end<this.minGapTimeBetween))return this.events[e];var i,n,s;return null},addEvent:function(e,n){if(!this.locationExists(e.location))throw new Error("Unknown location #"+e.location);var s=e.start instanceof Date?e.start:new Date(e.start),a=e.end instanceof Date?e.end:new Date(e.end);if(!h(s,a))throw new Error("Invalid time range: "+JSON.stringify([e.start,e.end]));var r={id:++this.lastEventId,name:e.name,location:e.location+"",start:s,end:a,data:e.data?t.extend({},e.data):null,url:e.url||!1,className:e.className||null,disabled:e.disabled||!1,active:e.active||!1,userData:t.extend({},e.userData||{})};if(n&&n.preserveId&&e.id){if(this.getEvent(e.id))throw new Error("Cannot preserve id: already exists");r.id=e.id}else r.id=++this.lastEventId;if(!n||!n.allowCollisions){var o=this.collide(r);if(o)throw new i.CollisionError(o.id)}return this.events.push(r),this.updateUnlessOption(n),r},addEvents:function(e,i){return e.forEach((function(e){this.addEvent(e,t.extend({},{update:!1},i))}),this),this.updateUnlessOption(i)},setEvents:function(t,e){return this.removeAllEvents(e).addEvents(t,e)},removeEvent:function(e,i){return t.each(this.events,t.proxy((function(t,i){if(i.id==e)return this.events.splice(t,1),!1}),this)),this.updateUnlessOption(i)},removeAllEvents:function(t){return this.$el.find(".sked-tape__event, .sked-tape__gap").remove(),this.events=[],this.updateUnlessOption(t)},getEvents:function(){return this.events},getEvent:function(e){var i=null;return t.each(this.events,t.proxy((function(t,n){if(n.id==e)return i=n,!1}),this)),i},isEditMode:function(){return this.editMode},enterEditMode:function(){return this.editMode=!0,this},leaveEditMode:function(){return this.isAdding()&&this.cancelAdding(),this.editMode=!1,this},startAdding:function(t){return this.dummyEvent=t,this.lastPicked&&(this.moveDummyEvent(this.lastPicked),this.updateDummyEvent()),this.rerenderLocations()},cancelAdding:function(){if(this.dummyEvent){var e=this.dummyEvent.draggedEvent;if(e){this.addEvent(e,{preserveId:!0,update:!0,allowCollisions:!0});var i=t.Event("event:dragCanceled.skedtape",{detail:{event:e}});this.$el.trigger(i,e)}delete this.dummyEvent}return this.$dummyEvent&&(this.$dummyEvent.remove(),delete this.$dummyEvent,this.$el.trigger("event:addingCanceled.skedtape")),this.rerenderLocations()},isAdding:function(){return!!this.dummyEvent},rerenderLocation:function(e){var i=this.$locations.filter((function(){return t(this).data("id")==e})),n=this.getLocation(e);i.length&&n&&i.replaceWith(this.renderLocation(n))},rerenderLocations:function(){return this.$locations.empty().append(this.renderLocations()),this},renderLocation:function(e){var i=t('<div class="sked-tape__location-text"/>').text(e.name),n=t('<li class="sked-tape__location"/>').attr({title:e.name,"data-id":e.id}).append(i),s=this.isAdding()?this.canAddIntoLocation(e,this.dummyEvent):void 0;return this.postRenderLocation(i,e,s),n},renderLocations:function(){var e=t(document.createDocumentFragment());return t.each(this.getLocations(),t.proxy((function(t,i){this.renderLocation(i).appendTo(e)}),this)),e},postRenderLocation:function(t,e,i){void 0!==i&&t.parent().toggleClass("sked-tape__location--permitted",i).toggleClass("sked-tape__location--forbidden",!i)},renderAside:function(){var e=t('<div class="sked-tape__aside"/>');t('<div class="sked-tape__caption"/>').text(this.caption).appendTo(e),this.$locations=t('<ul class="sked-tape__locations"/>').append(this.renderLocations()).appendTo(e),this.$el.append(e)},renderTimeWrap:function(e){var i=this.renderHours(),n=t('<div class="sked-tape__time-wrap"/>').appendTo(this.$el);this.$frame=t('<div class="sked-tape__time-frame" tabindex="0"/>').appendTo(n),this.$canvas=t('<div class="sked-tape__time-canvas"/>').append(i).appendTo(this.$frame),e&&this.$frame.scrollLeft(e);var s=t('<div class="sked-tape__timeline-wrap"/>').append(this.renderTimeRows()).append(this.renderGrid()),a=this.$canvas[0].scrollWidth;this.$canvas.css("min-width",Math.round(a*this.zoom)+"px").data("orig-min-width",a).append(s).append(i.clone()),this.showDates&&this.$canvas.prepend(this.renderDates())},renderDates:function(){var e,i=t('<ul class="sked-tape__dates"/>'),n=(e=this.start,(e=new Date(e)).setTime(e.getTime()+u(e)),e),a=function(t){return(t=new Date(t)).setTime(t.getTime()-l(t)),t}(this.end),r=[];if(n>a)r.push({weight:1,text:this.format.date(this.start)});else{r.push({weight:u(this.start)/s,text:this.format.date(this.start)});for(var d=new Date(n);d<a;)d.setTime(d.getTime()+1e3),r.push({weight:1,text:this.format.date(d)}),d.setTime(d.getTime()+s-1e3);r.push({weight:l(this.end)/s,text:this.format.date(this.end)})}var h=r.reduce((function(t,e){return t+e.weight}),0),c=this.end.getTime()-this.start.getTime();return r.forEach((function(e){var n=e.weight/h;t("<li/>").css("width",(100*n).toFixed(10)+"%").attr("title",e.text).addClass("sked-tape__date").toggleClass("sked-tape__date--short",n*c<=o).appendTo(i)})),i},renderHours:function(){for(var e=t("<ul/>"),i=new Date(this.start);i.getTime()<=this.end.getTime();){var n=i.getHours(),s=t("<time/>").attr("datetime",i.toISOString()).text(this.format.hours(24===n?0:n));t("<li/>").append(s).appendTo(e),i.setTime(i.getTime()+36e5)}var a=e.children();return a.not(":last-child").width(100/(a.length-1)+"%"),t('<div class="sked-tape__hours"/>').append(e)},renderGrid:function(){for(var e=t('<ul class="sked-tape__grid"/>'),i=new Date(this.start);i.getTime()<this.end.getTime();)t("<li/>").appendTo(e),i.setTime(i.getTime()+36e5);var n=e.children();return n.width(100/n.length+"%"),e},renderTimeRows:function(){this.$timeline=t('<ul class="sked-tape__timeline"/>');var e=this.events.sort(t.proxy((function(t,e){return t.start.getTime()-e.start.getTime()}),this));return this.timeIndicators={},t.each(this.getLocations(),t.proxy((function(i,n){var s=t('<li class="sked-tape__event-row"/>').data("locationId",n.id).appendTo(this.$timeline),a=t('<div class="sked-tape__indicator"/>').hide();this.timeIndicatorSerifs&&a.addClass("sked-tape__indicator--serifs"),this.timeIndicators[n.id]=a,s.append(a);var r,o=this.getIntersections(n.id),d=0;e.forEach((function(e){var i=e.location==n.id,a=e.end>this.start&&e.start<this.end;if(i&&a){var h=!1;t.each(o,t.proxy((function(i,n){if(t.each(n.events,(function(t,i){if(i.id==e.id)return h=!0,!1})),h)return!1}),this));var c=e.start.getTime()-d;c>=this.minTimeGapShown&&c<=this.maxTimeGapShown&&!h&&s.append(this.renderGap(c,r,e.start)),r=e.end,d=r.getTime();var l=this.renderEvent(e).appendTo(s);!1!==this.maxTimeGapHi&&c<=this.maxTimeGapHi?s.children(".sked-tape__event").filter(":eq(-1), :eq(-2)").addClass("sked-tape__event--low-gap"):h&&l.addClass("sked-tape__event--low-gap")}}),this)}),this)),this.renderIntersections(),this.$timeline},renderIntersections:function(){this.$timeline.find(".sked-tape__intersection").remove(),this.$timeline.find(".sked-tape__event-row").each(t.proxy((function(e,i){var n=t(i),s=n.data("locationId"),a=this.getIntersections(s);t.each(a,t.proxy((function(e,i){i.end>this.start&&i.start<this.end&&t('<div class="sked-tape__intersection"/>').css({width:this.computeEventWidth(i),left:this.computeEventOffset(i)}).data("events",i.events).appendTo(n)}),this))}),this))},renderGap:function(e,i,n){var s={start:i,end:n},r=t('<span class="sked-tape__gap-text"/>').text(Math.round(e/a));return t('<div class="sked-tape__gap"/>').css({width:this.computeEventWidth(s),left:this.computeEventOffset(s)}).append(r)},findEventJustBefore:function(e){var i=null;return t.each(this.events,(function(t,n){n.location==e.location&&n.end<e.start&&(!i||i.end<n.end)&&(i=n)})),i},findEventJustAfter:function(e){var i=null;return t.each(this.events,(function(t,n){n.location==e.location&&n.start>e.end&&(!i||i.start>n.start)&&(i=n)})),i},updateDummyEvent:function(){if(this.isAdding()){var e=this.dummyEvent;if(!this.$dummyEvent){this.$dummyEvent=t("<div/>").append('<div class="sked-tape__dummy-event-time sked-tape__dummy-event-time--left"/>').append('<div class="sked-tape__dummy-event-time sked-tape__dummy-event-time--right"/>')}var i=this.$dummyEvent.children(),n=i.filter(":first"),s=i.filter(":last");this.$dummyEvent[0].className="sked-tape__dummy-event "+(e.className||""),this.$dummyEvent.css({width:this.computeEventWidth(e),left:this.computeEventOffset(e)});var r=this.format.time(e.start),o=this.format.time(e.end);if(this.showIntermission){const t=this.findEventJustBefore(e);var d;t&&(d=Math.round((e.start-t.end)/a))>=this.intermissionRange[0]&&d<=this.intermissionRange[1]&&(r+="<br>+"+this.format.duration(d*a));const i=this.findEventJustAfter(e);i&&(d=Math.round((i.start-e.end)/a))>=this.intermissionRange[0]&&d<=this.intermissionRange[1]&&(o+="<br>+"+this.format.duration(d*a))}n.html(r),s.html(o);var h=this.$dummyEvent.closest(".sked-tape__event-row");h.length&&h.data("locationId")==e.location||(this.$dummyEvent.remove(),(h=this.$el.find(".sked-tape__event-row").filter((function(){return t(this).data("locationId")==e.location}))).length&&this.$dummyEvent.appendTo(h))}else this.$dummyEvent&&(this.$dummyEvent.remove(),delete this.$dummyEvent)},updateEvent:function(e){var i=this.getEvent(e),n=this.$timeline.find(".sked-tape__event").filter((function(){return t(this).data("eventId")==e}));if(i&&n.length){var s=this.renderEvent(i);n.replaceWith(s)}else this.update()},renderEvent:function(e){if(e.url&&!e.disabled)var i=t("<a/>").attr("href",e.url);else i=t("<div/>");i.addClass("sked-tape__event"),e.className&&i.addClass(e.className),i.toggleClass("sked-tape__event--disabled",!!e.disabled).toggleClass("sked-tape__event--active",!!e.active).attr("title",e.name).css({width:this.computeEventWidth(e),left:this.computeEventOffset(e)});var n=t('<div class="sked-tape__center"/>').text(e.name).appendTo(i);if(this.showEventTime||this.showEventDuration){var s=n.html(),a=this.format.roundDuration(e.end-e.start);this.showEventTime&&(s+="<br>"+this.format.time(e.start)+" - "+this.format.time(new Date(e.start.getTime()+a))),this.showEventDuration&&(s+="<br>"+this.format.duration(a)),n.html(s)}i.data(t.extend({},{eventId:e.id},e.data));var r=i.clone().css({width:"",left:"-10000px",top:"-10000px"}).appendTo(document.body);return i.data("min-width",r.outerWidth()),r.remove(),this.postRenderEvent(i,e),i},computeEventWidth:function(t){return c(this.clampEventStart&&this.start>t.start?this.start:t.start,this.end<t.end?this.end:t.end)/c(this.start,this.end)*100+"%"},computeEventOffset:function(t){var e=this.clampEventStart&&this.start>t.start?this.start:t.start;return c(this.start,e)/c(this.start,this.end)*100+"%"},updateTimeIndicatorsPos:function(){var t=this.start.getTime(),i=this.end.getTime(),n=(new Date).getTime();Object.keys(this.timeIndicators).forEach((function(s){var r=this.getLocation(s),o=void 0===r.tzOffset?this.tzOffset:r.tzOffset,d=n-(o-e)*a,h=this.timeIndicators[s];if(d>=t&&d<=i){var c=100*(d-t)/(i-t)+"%";h.show().css("left",c)}else h.hide()}),this)},hasIntersections:function(){for(var t,e,i,n=0;n<this.events.length;n++)for(t=this.events[n],i=n+1;i<this.events.length;i++)if(e=this.events[i],t.location===e.location&&v(t,e))return!0;return!1},getIntersections:function(e){var i=[],n=function(t){for(var e=0;e<i.length;++e)if(t.start.getTime()==i[e].start.getTime()&&t.end.getTime()==i[e].end.getTime())return!0;return!1};return t.each(this.events,t.proxy((function(t,s){if(s.location==e)for(var a=t+1;a<this.events.length;++a){var r=this.events[a];if(r.location==e){var o=v(s,r);o&&!n(o)&&(o.events=[s,r],i.push(o))}}}),this)),i},destroy:function(){this.cleanup(),this.$el.off().empty().removeClass("sked-tape sked-tape--has-dates")},cleanup:function(){t.fn.popover&&this.$el.find(".sked-tape__event").popover(n>=4?"dispose":"destroy"),this.indicatorTimeout&&(clearInterval(this.indicatorTimeout),delete this.indicatorTimeout)},render:function(e){var i=e&&e.preserveScroll&&this.$frame&&this.$frame.scrollLeft();return this.cleanup(),this.$el.empty().addClass("sked-tape"),this.showDates&&this.$el.addClass("sked-tape--has-dates"),this.renderAside(),this.renderTimeWrap(i),this.updateTimeIndicatorsPos(),this.indicatorTimeout=setInterval(t.proxy((function(){this.updateTimeIndicatorsPos()}),this),1e3),setTimeout(t.proxy((function(){var e='<div class="popover" role="tooltip"><div class="arrow"></div><div class="popover-'+(n>=4?"body":"content")+'"></div></div>';this.$el.find(".sked-tape__event").each(t.proxy((function(i,n){var s=t(n),a=s.width()<s.data("min-width"),r=parseFloat(s[0].style.left),o=r+parseFloat(s[0].style.width),d=r<-.01||o>100.01;t.fn.popover&&"never"!==this.showPopovers&&(a||d||"always"===this.showPopovers)&&s.popover({trigger:"hover",content:s.find(".sked-tape__center").html(),html:!0,template:e,placement:r<50?"right":"left"})}),this))}),this),0),this},update:function(){return this.render({preserveScroll:!0})},updateUnlessOption:function(t){var e=!t||void 0===t.update||t.update;return this.$timeline&&e?this.update():this},setSnapToMins:function(t){this.snapToMins=t},findEventsAtTime:function(e,i){var n=e.getTime(),s=[];return t.each(this.getEvents(),(function(t,e){e.location==i&&e.start.getTime()<=n&&e.end.getTime()>=n&&s.push(e)})),s},pick:function(e){var i,n=(e.pageX-this.$timeline.offset().left)/this.$timeline.width(),s=this.start.getTime()+n*(this.end.getTime()-this.start.getTime());return this.$el.find(".sked-tape__event-row").each((function(){var n=t(this).offset().top,s=n+t(this).height();if(e.pageY>=n&&e.pageY<=s)return i=t(this).data("locationId"),!1})),{locationId:i,date:new Date(Math.round(s))}},makeMouseEvent:function(e,i,n){return t.Event(e,t.extend({},n,{relatedTarget:i.currentTarget,clientX:i.clientX,clientY:i.clientY,offsetX:i.offsetX,offsetY:i.offsetY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,detail:t.extend(this.pick(i),n.detail)}))},dragEvent:function(e,i){if(i=i||{},!this.isAdding()){var n=this.getEvent(e),s=this.makeMouseEvent("event:dragStart.skedtape",i,{detail:{component:this,event:n}});if(this.$el.trigger(s,[this]),!s.isDefaultPrevented()){s=this.makeMouseEvent("event:dragStarted.skedtape",i,{detail:{component:this,event:n}});this.$el.trigger(s,[this]),this.removeEvent(e),this.startAdding({id:n.id,name:n.name,duration:n.end.getTime()-n.start.getTime(),userData:t.extend({},n.userData||{}),draggedEvent:n})}}},handleEventClick:function(e){var i=t(e.currentTarget).data("eventId"),n=this.getEvent(i);if(this.isEditMode())this.dragEvent(i,e);else{var s=this.makeMouseEvent("event:click.skedtape",e,{detail:{component:this,event:n}});this.$el.trigger(s,[this])}},handleEventContextMenu:function(e){if(e.preventDefault(),this.rmbCancelsAdding&&this.isAdding())return this.cancelAdding();var i=t(e.currentTarget).data("eventId"),n=this.getEvent(i),s=this.makeMouseEvent("event:contextmenu.skedtape",e,{detail:{component:this,event:n}});this.$el.trigger(s,[this])},handleIntersectionClick:function(t){var e=this.makeMouseEvent("intersection:click.skedtape",t,{detail:{component:this}}),i=e.detail;i.events=this.findEventsAtTime(i.date,i.locationId),this.$el.trigger(e,[this])},handleIntersectionContextMenu:function(t){if(t.preventDefault(),this.rmbCancelsAdding&&this.isAdding())return this.cancelAdding();var e=this.makeMouseEvent("intersection:contextmenu.skedtape",t,{detail:{component:this}}),i=e.detail;i.events=this.findEventsAtTime(i.date,i.locationId),this.$el.trigger(e,[this])},completeAdding:function(t){var e=this.dummyEvent;if(this.collide(e)){var i=this.makeMouseEvent("event:dragEndRefused.skedtape",t,{detail:{component:this,event:e}});this.$el.trigger(i,[this])}else{i=this.makeMouseEvent("event:dragEnd.skedtape",t,{detail:{component:this,event:e}});if(this.$el.trigger(i,[this]),!i.isDefaultPrevented())try{var n=this.addEvent(e,{preserveId:!0,update:!0});delete e.duration,delete this.dummyEvent,this.$dummyEvent.remove(),delete this.$dummyEvent;i=this.makeMouseEvent("event:dragEnded.skedtape",t,{detail:{component:this,event:n}});this.$el.trigger(i,[this]),this.rerenderLocations()}catch(t){if("SkedTape.CollisionError"!==t.name)throw t;i=this.makeMouseEvent("event:dragEndRefused.skedtape",t,{detail:{component:this,event:e}});this.$el.trigger(i,[this])}}},handleTimelineClick:function(t){if(!d(t))if(this.isAdding())this.dummyEvent.location&&this.completeAdding(t);else{var e=this.makeMouseEvent("timeline:click.skedtape",t,{detail:{component:this}});this.$el.trigger(e,[this])}},handleTimelineContextMenu:function(t){if(!d(t)){if(t.preventDefault(),this.rmbCancelsAdding&&this.isAdding())return this.cancelAdding();var e=this.makeMouseEvent("timeline:contextmenu.skedtape",t,{detail:{component:this}});this.$el.trigger(e,[this])}},moveDummyEvent:function(e){var i=this.dummyEvent,n=e.date;if(this.snapToMins){var s=m(n),r=(n.getTime()-s.getTime())/a,o=Math.floor(r/this.snapToMins)*this.snapToMins,d=r-o<this.snapToMins/2?o:o+this.snapToMins;n=new Date(s.getTime()+Math.round(d*a))}if(t.extend(i,{start:n,end:new Date(n.getTime()+i.duration)}),e.locationId){var h=this.getLocation(e.locationId);this.canAddIntoLocation(h,i)&&(this.beforeAddIntoLocation(h,i),i.location=e.locationId)}},handleMouseMove:function(t){this.lastPicked=this.pick(t),this.isAdding()&&(this.moveDummyEvent(this.lastPicked),this.updateDummyEvent())},handleKeyDown:function(t){"+"===t.key?this.zoomIn():"-"===t.key&&this.zoomOut()},handleWheel:function(t){if(t.ctrlKey)return t.originalEvent.deltaY<0?this.zoomIn():this.zoomOut(),!1;if(!t.shiftKey&&this.scrollWithYWheel){var e=t.originalEvent.deltaY>0?1:-1;if(e*=.9*this.$frame.width(),this.$frame.queue().length){var i=this.$frame.scrollLeft();e+=this.$frame.finish().scrollLeft()-i,this.$frame.scrollLeft(i)}return this.$frame.animate({scrollLeft:"+="+e},200),!1}}},i.CollisionError=function(t){this.message="Collision with entry #"+t,this.eventId=t,"captureStackTrace"in Error?Error.captureStackTrace(this,i.CollisionError):this.stack=(new Error).stack},i.CollisionError.prototype=Object.create(Error.prototype),i.CollisionError.prototype.name="SkedTape.CollisionError",i.CollisionError.prototype.constructor=i.CollisionError;var n=t.fn.popover?parseInt(t.fn.popover.Constructor.VERSION.charAt(0),10):0,s=864e5,a=6e4,r=60*a,o=2*r-1;function d(e){return!!t(e.target).closest(".sked-tape__event, .sked-tape__intersection").length}function h(t,e){return t instanceof Date&&e instanceof Date&&t<=e}function c(t,e){return(e.getTime()-t.getTime())/1e3/60/60}function l(t){return 1e3*(60*t.getHours()*60+60*t.getMinutes()+t.getSeconds())+t.getMilliseconds()}function u(t){return s-l(t)}function m(t){var e=new Date(t);return e.setHours(t.getHours(),0,0,0),e}function v(t,e){var i=t.start<e.start?t:e,n=i==t?e:t;return i.end<n.start?null:{start:n.start,end:i.end<n.end?i.end:n.end}}t.fn.skedTape=function(e){var n=e&&("string"==typeof e||e instanceof String)?e:"";e=e&&!n&&"object"==typeof e?t.extend({},e):{};var s=n?Array.prototype.slice.call(arguments,1):[];return this.each((function(){var a=t(this).data(t.fn.skedTape.dataKey);if(a&&n)if("destroy"===n)a.destroy(),t(this).removeData(t.fn.skedTape.dataKey);else{if(!(["addEvent","addEvents","removeEvent","setEvents","removeAllEvents","enterEditMode","leaveEditMode","startAdding","cancelAdding","setLocations","addLocation","addLocations","removeLocation","setTimespan","setDate","zoomIn","zoomOut","setZoom","resetZoom","render","setSnapToMins","dragEvent","updateEvent"].indexOf(n)>=0))throw new Error("SkedTape plugin cannot recognize command");a[n].apply(a,s)}else{if(n)throw new Error("SkedTape plugin hadn't been initialized but used");a&&a.destroy();var r=t.extend({},t.fn.skedTape.defaults,e,{el:this});delete r.locations,delete r.events,delete r.start,delete r.end,delete r.deferRender,a=new i(r),e.start&&e.end&&a.setTimespan(e.start,e.end,{update:!1}),e.locations&&a.setLocations(e.locations,{update:!1}),e.events&&a.setEvents(e.events,{update:!1,allowCollisions:!0}),t(this).data(t.fn.skedTape.dataKey,a),e.deferRender||a.render()}}))},t.fn.skedTape.dataKey="sked-tape",t.fn.skedTape.format=i.defaultFormatters,t.fn.skedTape.defaults={caption:"",maxZoom:10,zoomStep:.5,zoom:1,showEventTime:!1,showEventDuration:!1,showDates:!0,minGapTimeBetween:0,minTimeGapShown:1*a,maxTimeGapShown:60*a-1,maxTimeGapHi:!1,clampEventStart:!1,scrollWithYWheel:!1,sorting:!1,orderBy:"order",snapToMins:1,rmbCancelsAdding:!0,tzOffset:e,timeIndicatorSerifs:!1,showIntermission:!1,intermissionRange:[1,60],showPopovers:"default",canAddIntoLocation:function(t,e){return!0},beforeAddIntoLocation:function(t,e){},postRenderLocation:function(t,e,n){i.prototype.postRenderLocation.call(this,t,e,n)},postRenderEvent:function(t,e){}},t.skedTape=function(e){return t("<div/>").skedTape(t.extend({},e||{},{deferRender:!0}))}}));
//# sourceMappingURL=jquery.skedTape.min.js.map
